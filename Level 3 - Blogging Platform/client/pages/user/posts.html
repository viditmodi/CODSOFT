<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="../../css/main.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />

    <script src="../../templates/header.js"></script>
    <script src="../../templates/loader.js"></script>
    <script src="../../templates/sideNavBar.js"></script>
    <script src="../../templates/gallery.js"></script>
    <script src="../../js/auth.js"></script>
    <script src="/js/data/apiURLs.js"></script>

    <title>Document</title>
  </head>
  <body onload="onLoadHandler()">
    <header class="header" id="Header"></header>

    <section id="blogSelector">
      <select name="blogDropdown" id="blogDropdown"></select>
      <button onclick="setBlog()">select</button>
    </section>

    <section class="posts-view" id="posts">
      <div class="posts-view__blog-meta-group wrapper">
        <!-- bg will be the thumbnail -->
        <div class="posts-view__blog-meta">
          <button>like</button>
          <button>follow</button>
        </div>
      </div>
      <section class="wrapper" id="galleryContainer"></section>
    </section>

    <button id="newPostButton">New Post</button>

    <script>
      const loadData = {
        logoURL: "../../assets/images/logo.png",
        navBarData: [
          {
            link: "/pages/user/dashboard.html",
            text: "dashboard",
          },
          {
            link: "/pages/user/blogs.html",
            text: "blogs",
          },
          {
            link: "/pages/user/posts.html",
            text: "posts",
            active: true,
          },
          {
            link: "/pages/auth/logout.html",
            text: "logout",
          },
        ],
      };
      const header = document.getElementById("Header");
      const body = document.getElementsByTagName("body")[0];
      createLoader()


      const params = new URLSearchParams(window.location.search);
      const blogID = params.get("blogid");

      const newPostButton = document.getElementById("newPostButton")
      newPostButton.addEventListener("click", ()=>{
        if(blogID){
          window.location.href = "/pages/blog/add-post.html?blogid="+blogID
        }
        else{
          window.location.href = "/pages/blog/add-post.html"
        }
      })


      const onLoadHandler = async () => {
        if (!checkLoginStatus()) {
          window.location.href = "/pages/auth/login.html";
        }
        createHeader(header, loadData)
        createSideNavBar(loadData.navBarData);

        const blogList = JSON.parse(
          localStorage.getItem("quillcraft_userbloglist")
        );

        const blogDropdown = document.getElementById("blogDropdown");
        blogList.forEach((blog) => {
          const option = document.createElement("option");
          option.value = blog.blogID;
          option.innerText = blog.title;
          // option.addEventListener('click', ()=>{
          //     console.log(`http://127.0.0.1:5501/pages/blog/add-post.html?blogid=${blog.blogID}`)
          //     window.location.href = `http://127.0.0.1:5501/pages/blog/add-post.html?blogid=${blog.blogID}`
          // })

          blogDropdown.appendChild(option);
        });

        const newPost = document.getElementById("posts");
        const blogSelector = document.getElementById("blogSelector");
        if (!blogID) {
          newPost.style.display = "none";
          blogSelector.style.display = "flex";
        } else {
          newPost.style.display = "block";
          blogSelector.style.display = "none";
          
          const response = await fetch(allPostURL + `?blogID=${blogID}`)
          const res = await response.json()
  
          console.log(res.data)
  
          createGallery(document.getElementById("galleryContainer"), "posts", "Blog List", res.data)
        }








        removeLoader()
      };


      const setBlog = () => {
        const blogDropdown = document.getElementById("blogDropdown");

        window.location.href = `/pages/user/posts.html?blogid=${blogDropdown.value}`;
      };
    </script>
  </body>
</html>
